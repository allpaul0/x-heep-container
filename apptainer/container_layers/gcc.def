Bootstrap: localimage
From: container_layers/build/conda.sif

%environment
    export RISCV=/opt/tools/riscv
    export PATH=${RISCV}/bin:$PATH

%post
    cd /opt
    # Clone the RISC-V GNU toolchain (including GCC, binutils, newlib, etc.)
    git clone https://github.com/riscv-collab/riscv-gnu-toolchain
    cd riscv-gnu-toolchain
    # Configure for a newlib cross-compiler with prefix /opt/tools/riscv
    ./configure --prefix=/opt/tools/riscv --with-arch=rv32i --with-abi=ilp32 --enable-multilib --with-multilib-generator="rv32i-ilp32--;rv32ic-ilp32--;rv32im-ilp32--;rv32imc-ilp32--;rv32i_zicsr_zmmul-ilp32--;rv32ic_zicsr_zmmul-ilp32--;rv32e-ilp32e--;rv32ec-ilp32e--;rv32em-ilp32e--;rv32emc-ilp32e--;rv32e_zicsr_zmmul-ilp32e--;rv32ec_zicsr_zmmul-ilp32e--;rv32if_zicsr-ilp32f--;rv32ifc_zicsr-ilp32f--;rv32imf_zicsr-ilp32f--;rv32imfc_zicsr-ilp32f--;rv32if_zicsr_zmmul-ilp32f--;rv32ifc_zicsr_zmmul-ilp32f--;rv32ifd_zicsr-ilp32d--;rv32ifdc_zicsr-ilp32d--;rv32imfd_zicsr-ilp32d--;rv32imfdc_zicsr-ilp32d--;rv32ifd_zicsr_zmmul-ilp32d--;rv32ifdc_zicsr_zmmul-ilp32d--;"
    # Build the toolchain (this will build GCC, binutils, newlib, etc.)
    make -j$(nproc)