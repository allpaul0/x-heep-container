Bootstrap: localimage
From: container_layers/build/verible.sif

%labels
    Stage conda environment

%environment
    echo $PATH
    # Source conda.sh so "conda activate" works
    . /opt/tools/conda/etc/profile.d/conda.sh
    export PY=/opt/tools/conda/bin/python
    echo $PATH

%post
    export DEBIAN_FRONTEND=noninteractive

    # Install Miniconda
    cd /tmp
    wget -q https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh
    bash miniconda.sh -b -p /opt/tools/conda
    rm miniconda.sh

    # Accept TOS for main + r channels (optional, to avoid prompts)
    /opt/tools/conda/bin/conda tos accept --override-channels --channel https://repo.anaconda.com/pkgs/main || true
    /opt/tools/conda/bin/conda tos accept --override-channels --channel https://repo.anaconda.com/pkgs/r || true